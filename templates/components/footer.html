<footer class="contacts bg-background-secondary text-background py-12 sm:py-16 lg:py-24 mt-12 sm:mt-16 lg:mt-24 min-h-[600px] sm:min-h-[700px]" id="contacts">
    <div class="max-w-[1280px] mx-auto px-5 sm:px-8 lg:px-12 flex flex-col gap-8 sm:gap-12 h-full">
        <div class="flex flex-col gap-3">
            <div class="flex flex-row gap-2 items-center">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1 4L7.49521 7.75L1 11.5" stroke="var(--background)" stroke-width="1" />
                    <path d="M7.49521 4L13.9904 7.75L7.49521 11.5" stroke="var(--background)" stroke-width="1" />
                </svg>
                <p class="font-light text-sm sm:text-base">Контакты</p>
            </div>
            <h2 class="text-3xl sm:text-4xl lg:text-5xl font-light text-white mb-4 sm:mb-6 leading-tight">Свяжитесь с нами</h2>
        </div>
        <div class="flex flex-col lg:flex-row gap-4 lg:gap-2 w-full flex-grow">
            <!-- Блок контактов -->
            <div class="bg-card-secondary w-full lg:w-1/2 p-5 sm:p-6 rounded-xl flex flex-col gap-4">
                <h4 class="text-lg sm:text-xl font-medium">Контакты</h4>
                <div class="flex flex-col gap-2">
                    <a class="text-secondary text-sm sm:text-base hover:text-white transition-colors" href="tel:+70000000000">+7 (000) 000-00-00</a>
                    <a class="text-secondary text-sm sm:text-base hover:text-white transition-colors" href="mailto:example@domain.ru">example@domain.ru</a>
                </div>
            </div>

            <!-- Форма -->
            <div class="w-full lg:w-1/2">
                <div class="bg-card-secondary p-5 sm:p-6 rounded-xl flex flex-col gap-6">
                    <div class="flex flex-col gap-4">
                        <h3 class="text-lg sm:text-xl font-medium">Оставить заявку</h3>
                        <p class="text-xs sm:text-sm text-secondary">И мы перезвоним вам в ближайшее время</p>
                    </div>
                    <form class="space-y-5 text-sm" onsubmit="submitForm(event)">
                        <div class="space-y-4">
                            <div>
                                <input type="text" name="name" placeholder="Ваше имя" required class="w-full bg-transparent pr-4 py-2 border-b border-border-300 focus:outline-none focus:border-white placeholder:text-secondary transition-colors text-sm sm:text-base" />
                            </div>
                            <div>
                                <input type="tel" name="phone" id="phone" placeholder="Ваш телефон" required class="w-full bg-transparent pr-4 py-2 border-b border-border-300 focus:outline-none focus:border-white placeholder:text-secondary transition-colors text-sm sm:text-base" pattern="\+7 \([0-9]{3}\) [0-9]{3}-[0-9]{2}-[0-9]{2}" />
                            </div>
                            <div>
                                <textarea name="comment" placeholder="Комментарий (необязательно)" class="w-full bg-transparent pr-4 py-2 border-b border-border-300 focus:outline-none focus:border-white resize-none h-20 placeholder:text-secondary transition-colors text-sm sm:text-base"></textarea>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div class="flex items-start gap-2">
                                <div class="relative mt-1 flex-shrink-0">
                                    <input type="checkbox" id="privacy" name="privacy" required class="peer appearance-none h-4 w-4 rounded-md border border-border-300 bg-transparent checked:border-background cursor-pointer hover:border-white transition-colors" />
                                    <svg class="absolute hidden peer-checked:block top-[2px] left-[2px] w-3 h-3 pointer-events-none" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M13.3334 4L6.00008 11.3333L2.66675 8" stroke="var(--background)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                </div>
                                <label for="privacy" class="text-xs text-secondary leading-relaxed text-balance">
                                    Отправляя заявку, я соглашаюсь
                                    <a href="/privacy" class="underline underline-offset-4 hover:text-white transition-colors" target="_blank"> с политикой в отношении обработки персональных данных </a>
                                </label>
                            </div>

                            <div id="formMessage" class="text-sm hidden"></div>
                            <button type="submit" class="bg-background text-foreground px-6 sm:px-8 py-3 sm:py-4 rounded-full w-full sm:w-fit text-sm sm:text-base hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed">Отправить заявку</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const phoneInput = document.getElementById('phone');
            if (!phoneInput) return;

            phoneInput.addEventListener('input', onPhoneInput);
            phoneInput.addEventListener('focus', onPhoneFocus);
            phoneInput.addEventListener('blur', onPhoneBlur);

            function onPhoneFocus() {
                if (!this.value) {
                    this.value = '+7 (';
                }
            }

            function onPhoneBlur() {
                if (this.value === '+7 (' || this.value === '+7') {
                    this.value = '';
                }
            }

            function onPhoneInput(e) {
                const input = e.target;
                const numbers = input.value.replace(/\D/g, '');

                // Ограничиваем максимум 11 цифр (7 + 10 цифр)
                let formatted = '+7';
                if (numbers.length > 1) {
                    formatted += ' (' + numbers.slice(1, 4);
                }
                if (numbers.length >= 5) {
                    formatted += ') ' + numbers.slice(4, 7);
                }
                if (numbers.length >= 8) {
                    formatted += '-' + numbers.slice(7, 9);
                }
                if (numbers.length >= 10) {
                    formatted += '-' + numbers.slice(9, 11);
                }

                input.value = formatted;
            }
        });

        async function submitForm(event) {
            event.preventDefault();

            const form = event.target;
            const phoneInput = form.querySelector('#phone');
            const messageDiv = document.getElementById('formMessage');
            const submitButton = form.querySelector('button[type="submit"]');
            const privacyCheckbox = form.querySelector('#privacy');

            const phoneDigits = phoneInput.value.replace(/\D/g, '');
            if (phoneDigits.length !== 11) {
                messageDiv.textContent = 'Введите полный номер телефона';
                messageDiv.className = 'text-sm text-red-500';
                messageDiv.classList.remove('hidden');
                return;
            }

            if (!privacyCheckbox.checked) {
                messageDiv.textContent = 'Необходимо согласиться с условиями обработки персональных данных';
                messageDiv.className = 'text-sm text-red-500';
                messageDiv.classList.remove('hidden');
                return;
            }

            const formData = new FormData(form);

            try {
                submitButton.disabled = true;
                messageDiv.textContent = 'Отправка...';
                messageDiv.className = 'text-sm text-white';
                messageDiv.classList.remove('hidden');

                const response = await fetch('/submit-application', {
                    method: 'POST',
                    body: formData,
                });

                const result = await response.json();

                if (result.status === 'success') {
                    messageDiv.textContent = result.message;
                    messageDiv.className = 'text-sm text-green-500';
                    form.reset();
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                messageDiv.textContent = error.message || 'Произошла ошибка при отправке формы';
                messageDiv.className = 'text-sm text-red-500';
            } finally {
                messageDiv.classList.remove('hidden');
                submitButton.disabled = false;
            }
        }
    </script>
</footer>
